# Практическое занятие 3: Беспроводные сети и энергосберегающие режимы

В качестве "скелета" для приложения под RIOT, работающего с LoRaWAN, можно использовать пример `examples-miem/lorawan`. В 234 аудитории установлен шлюз LoRaWAN, работающий с сетевым сервером https://chirpstack.auditory.ru, вход по МИЭМовскому логину/паролю.

Пример построения сети 6LoWPAN поверх BLE из нескольких устройств на базе микроконтроллеров nRF52 будет показан на одном из практических занятий.

## Задания

1. (1) Спецификация LoRaWAN требует, чтобы интервалы между повторными попытками передачи данных или JoinRequest выбирались случайным образом. Добавьте эти возможности в приложение.

1. (1) Сформируйте пакет, выводящий из строя устройства со старой версий Riot (посмотрите содержимое коммита `fffe8bb7328a61ab9756b28089c4f987a7f46f53`, из него должно быть ясно, в чем проблема).

1. (2) CoAP - соедините две или три отладочных платы nRF52-DK в сеть 6LoWPAN поверх BLE (например, используя модуль NimBLE autoconn). Запустите на одной из плат сервер, а на другой клиент CoAP и продемонстрируйте обмен сообщениями.

1. (2) Добавьте в `skald` поддержку "маячков" типа Eddystone-TLM и Eddystone-EID. (10) Добейтесь принятия ваших изменений в upstream.

1. (2-...) Добавьте работу с радиосетью (LoRaWAN или 6LoWPAN поверх BLE) к любому из устройств в первом и втором блоках заданий (светофор, сейф, датчики, ...). Дополнительные баллы начисляются за оригинальность и обоснованность принятых при разработке решений (например, транслирующий свое состояние BLE-маячками светофор - устройство довольно бессмысленное, если вы меня не переубедите - а светофор, расписание работы которого передается по LoRaWAN - уже довольно интересная штука). Кроме того, можно использовать любые дополнительные внешние устройства (например: кодовый замок со считывателем смарт-карт и кода с клавиатуры, имеющий возможность обновления списка "разрешенных" карт и значения кода по радио - рекомендуется LoRaWAN, а кроме того, сообщающий серверу сети о всех попытках "входа" - вполне можно оценить баллов этак на 5, если вся заявленная функциональность нормально работает).

1. (2) Описана "атака" на автосигнализацию со счетчиком переданных сообщений, в которой злоумышленник имеет возможность глушить передачи данных от брелка, а также записывать и воспроизводить их (например, здесь: https://www.drive2.ru/b/957013/). Представьте себе аналогично устроенный "умный замок" для LoRaWAN - открывающийся, например, при получении пакета с заранее определенным payload (например, четыре байта "open"). Подвержен ли он подобной атаке? Если нет - объясните, почему, если да - продемонстрируйте устройство, осуществляющее аналогичные действия.

1. (2) В модуле LoRaWAN для операционной системы mbed отсутствует поддержка частотного плана RU864. Добавьте ее. (10) Добейтесь принятия ваших изменений в upstream.

1. (2) В операционной системе mbed неоптимальным с точки зрения энергопотребления реализован переход микроконтроллеров семейства STM32L1 в спящий режим (частично проблема описана тут: https://habr.com/ru/articles/420435/). Исправьте. (10) Добейтесь принятия ваших изменений в upstream.

## Задания из прошлых блоков

Некоторые из заданий, предлагавшихся к выполнению раньше, можно сдать и сейчас.

1. (3; без операционной системы) Добавьте в реализацию USB-UART на отладочной плате UMDK-RF обработку команды `USB_CDC_REQ_SEND_BREAK` (при этом на выводе TX на заданное время устанавливается логический 0). Условие приема задания - подключение и прошивка микроконтроллера TI CC3200 через его UART-загрузчик (для его запуска требуется корректная реализация этой команды); сообщите заранее о желании сдать это задание. В этом проекте отсутствует операционная система, используется библиотека libopencm3.

1. (5) Портируйте Riot на "локатор" из Макдональдса. (10) Добавьте ваши изменения в community-версию Riot.

1. (2-4) Добавьте драйвер любого внешнего устройства, которого еще нет в RIOT.
