# Практическое занятие 2: процессы, межпроцессное взаимодействие, драйверы, интерфейсы внешних устройста

## Необходимая документация

Управление процессами в RIOT описано в документации ОС:

https://doc.riot-os.org/group__core.html

Для работы с внешними устройствами можно использовать имеющиеся в комплекте оборудования модули с датчиками освещенности OPT3001 (UMDK-LIT), температуры-влажности-давления BME280 (UMDK-THP), акселерометром/гироскопом LSM6DS3 (UMDK-ACC). Все они подключены по интерфейсу I2C, пример работы с этими датчиками выложен на Github (`examples-miem/sensors`). Описания драйверов устройств смотрите в каталоге RIOT, они приведены в соответствующих заголовочных файлах в формате Doxygen.

## Задания

1. (1) Продемонстрируйте в RIOT инверсию приоритетов (в том числе с участием "среднеприоритетного" процесса, не конкурирующего за ресурс) и взаимоблокировку потоков. Включите опцию "наследования приоритета" при захвате mutex-а, убедитесь, что она работает. Какие недостатки имеет это решение?

2. (1) Установите на "материнскую" плату UMDK-RF модули UMDK-LIT (датчик освещенности OPT3001) и UMDK-THP (датчик температуры-влажности-давления BME280). Проверьте работоспособность приложения `examples-miem/sensors`. Как видно из кода приложения, автор хотел производить измерения освещенности в 10 раз чаще, чем измерения состояния атмосферы - но на каждое измерение температуры приходится только 9 измерений освещенности. Почему и как это исправить?

3. (1) Подключите одновременно датчики температуры-влажности-давления BME280 и DHT11, сравните их показания.

4. (1) Реализуйте датчик удара/перемещения с использованием акселерометра (например, при ударе или перемещении устройства зажигайте светодиод).

5. (1) Включите в приложение модуль shell (`sys/shell`), добавьте несколько команд, например, для получения данных от датчиков.

6. (2) Подключите модуль ST95HF, реализуйте его опрос с использованием стандартного драйвера. (1) - объедините кодовый замок из предыдущего практического занятия с модулем чтения карт.

7. (2) Добавьте опрос нескольких датчиков, получение данных от них, управление GPIO и тому подобное - на ваш выбор - по протоколу Modbus RTU, используя штатный ("консольный") UART. Для проверки работы Modbus будет использоваться программа Termite: http://s2-team.ru/termite-quick-start-guide/

8. (2) Используя рекомендации фирмы Maxim (https://www.maximintegrated.com/en/design/technical-documents/tutorials/2/214.html) и драйвер 1-wire (`drivers/onewire`), подключите к микроконтроллеру устройство с интерфейсом 1-Wire (например, "домофонный" ключ). Нужно использовать второй UART и дополнительную внешнюю "обвязку".

9. (2-4) Добавьте драйвер любого внешнего устройства, которого еще нет в RIOT.

10. (2) Реализуйте простой планировщик с кооперативной многозадачностью для protothreads (http://www.dunkels.com/adam/pt/).
