# Некоторые комментарии к лекциям

Какого-то единого учебника, где рассматривались бы все вопросы курса, нет, но по многим вопросам могу отослать к следующим источникам:

https://www.youtube.com/playlist?list=PLJEYfuHbcEIApuZR4L5tRiBCwTZCYeTNY - прочитанный Олегом Артамоновым в 2018 году курс в МИРЭА, во многом повторяющийся и здесь.

**Elecia White, Making Embedded Systems** - учебник по разработке встраиваемых систем, не скатывающийся в "Очередное руководство по STM32" и одновременно достаточно простой для начинающих.

**Jack Ganssle, Art of Designing Embedded Systems** - сборник авторских статей, рассматривающих самые разные вопросы проектирования устройств на микроконтроллерах - в диапазоне от правильной организации труда до нюансов программирования в системах, требующих "реального времени".

**P. Horowitz, W. Hill, The Art of Electronics** / **П. Хоровиц, У. Хилл, Искусство схемотехники** (разные издания) - довольно фундаментальное руководство по проектированию электроники, здесь я буду ссылаться лишь на отдельные главы, в основном посвященные цифровой электронике. Нумерация глав соответствует 3 английскому изданию (вроде бы есть его неполный перевод на русский, но я его особо не изучал).

**E. A. Lee, S. A. Seshia, Introduction to Embedded Systems: A Cyber-Physical Systems Approach** - немного нестандартный учебник по встраиваемым системам, начинающийся с тяжелой математики и довольно сильно ориентированный на формальное моделирование систем.

**Chris Hobbs, Embedded Software Development for Safety-Critical Systems** - книга посвящена разработке безопасных встраиваемых систем, и охватывает самые разнообразные темы - от структуры соответствующих стандартов до методов верификации программ.

**Документация по RIOT OS** (https://doc.riot-os.org/) - в курсе мы будем использовать именно эту операционную систему.

Некоторые из последующих ссылок (в основном на сайты американских фирм-производителей микроэлектронной техники) требуют использования VPN или других средств обхода санкций.

## Лекция 1

Лекция вводная, поэтому очень многие из рассматриваемых вопросов будут повторяться и дальше. Рекомендую ознакомиться с **RFC 7228**, который рассматривает не только ограничения по объему памяти для устройств Интернета вещей, но также касается вопросов энергопотребления и организации сетей таких устройств.

Определение основных функций операционной системы взято из **Современных операционных систем** Таненбаума.

## Лекция 2

Хорошее дополнение к части про GPIO - 10 и 12 главы **The Art of Electronics**, где описываются основные типы цифровой логики и взаимодействие между ними (в том числе интерфейсы между логическими микросхемами разных типов или с разными логическими уровнями). Кроме того, в самой лекции был упомянут документ Philips Semiconductor **AN97055**, в котором описывается несложный преобразователь логических уровней. Довольно много схем преобразователей логических уровней упоминается в документе Microchip **3V Tips ‘n Tricks**.

Множество методов борьбы с "дребезгом" контактов приводит Jack Ganssle: http://www.ganssle.com/item/debouncing-switches-contacts-code.htm . Примерно то же самое приведено в 5 главе его книги **Art of Designing Embedded Systems**.

В немного более "низкоуровневом" виде материалу лекции примерно соответствует глава 4 в "Making Embedded Systems" (особенно рекомендую посмотреть там раздел про аппаратные таймеры, сильно сокращенный в нашем курсе).

## Лекция 3

Глава 5 в **Making Embedded Systems** описывает несколько способов организации программ для встраиваемых устройств без использования операционной системы, а также довольно подробно описывает процесс обработки прерываний (и некоторые возникающие при этом проблемы). Кроме того, 4 глава **Art of Designing Embedded Systems** содержит описание многих проблем, возникающих в системах реального времени. В главе 10 **Introduction to Embedded Systems: A Cyber-Physical Systems Approach** довольно подробно описаны проблемы, возникающие при использовании прерываний, а в главе 11 и 12 - общие принципы работы многопоточных систем.

Кроме того, для "общего развития" можно посмотреть официальные и не очень руководства по разнообразным операционным системам для встраиваемых устройств:

**Андрей Курниц, цикл статей по FreeRTOS в журнале "Компоненты и технологии", №2-10, 2011** - описание популярного ядра ОС FreeRTOS; в этом курсе мы ее не используем из-за полного отсутствия совместимого с ней hardware abstraction layer для разных семейств МК, но ознакомиться было бы неплохо.

**Getting Started: Building Applications with RL-ARM** (https://www.keil.com/product/brochures/rl-arm_gs.pdf) - справочник по операционной системе Keil RTX, это операционная система, входящая в комплект одноименной среды разработки для ARM. Не сильно отличается по возможностям от любой другой микроконтроллерной ОС, но распространяется только в "закрытом" виде за большие деньги. Как можно понять из руководства - общие возможности ядра ОС примерно те же, что и "у всех".

**TinyOS: An Operating System for Sensor Networks** (https://people.eecs.berkeley.edu/~culler/papers/ai-tinyos.pdf) - описание операционной системы TinyOS и разработанного для нее языка программирования nesC. Довольно интересно посмотреть на реализованный там подход к "многозадачности".

**Contiki - a Lightweight and Flexible Operating System for Tiny Networked Sensors** (http://www.dunkels.com/adam/dunkels04contiki.pdf) - описание операционной системы Contiki, довольно долгое время бывшей "стандартом" для программирования устройств IoT. Можно дополнить руководством по protothreads: http://www.dunkels.com/adam/pt.

"Верхнеуровневое" описание Riot можно найти в статье его авторов: https://www.riot-os.org/assets/pdfs/riot-ieeeiotjournal-2018.pdf. Довольно подробное описание сетевого стека Riot есть в магистерской работе Martine Lenders: http://doc.riot-os.org/mlenders_msc.pdf.

## Лекция 4

Интерфейсы UART, I2C и SPI описаны повсюду, довольно компактное по размеру описание можно найти в главе 14 **The Art of Electronics** (раздел 14.7, Serial buses and data links). Вопросы реализации 1-wire с помощью UART описаны в документе Maxim Integrated **Using a UART to Implement a 1-Wire Bus Master** (https://www.maximintegrated.com/en/design/technical-documents/tutorials/2/214.html). О допустимой рассинхронизации между двумя UART можно прочитать в одном из руководств Analog Devices (https://www.analog.com/en/technical-articles/determining-clock-accuracy-requirements-for-uart-communications.html).

Реализацию CMSIS-DAP (https://www.keil.com/pack/doc/CMSIS/DAP/html/index.html) с помощью bit-banging можно посмотреть здесь: https://github.com/unwireddevices/dap42

Некоторые вопросы взаимодействия с периферийными устройствами рассматриваются в главе 6 **Making Embedded Systems** и главе 10 **Introduction to Embedded Systems: A Cyber-Physical Systems Approach**.

## Лекция 5

Тема цифровой радиосвязи бесконечная, и если вы хотите заниматься этими вопросами всерьез - то можно начать с пары классических учебников:

**John Proakis, Digital Communications / Джон Проакис, Цифровая связь** (разные издания) - учебник по системам цифровой связи, для базового понимания предмета несколько избыточный, но можно ограничиться лишь главами 2 и 6.

**Andrea Goldsmith, Wireless Communications** (2nd edition) - учебник по беспроводным системам связи, применяющийся в курсе EE359 университета Стенфорда (https://web.stanford.edu/class/ee359/courseinfo.html - там же и ссылка на PDF учебника). Написан несколько проще, чем предыдущий, опять же, можно ограничиться 1, 2, 5, 6 и 13 главами.

Хочется отметить, что использование радиосетей для передачи цифровых данных едва ли не "древнее" современных интернет-протоколов. Забавный курьез - один из разработчиков Ethernet, Robert Metcalfe использовал в этом протоколе некоторые механизмы, позаимствованные из пакетной радиосети ALOHA, разработанной в 70-х в университете Гавайев. Протокол ALOHA упоминается во многих учебниках по компьютерным сетям, обычно лишь в качестве исторического курьеза - но при этом он является важным примером сетевого протокола, свойства которого изучены с точки зрения математики - например, анализу различных вариантов ALOHA посвящено пол-главы в книге **Dimitri P. Bertsekas, Robert G. Gallager, Data Networks** (http://web.mit.edu/dimitrib/www/datanets.html) - рекомендую как пример "математического" подхода к анализу компьютерных сетей.

В остальном же мы будем рассматривать сети с использованием протоколов 6LoWPAN поверх IEEE 802.15.4 и BLE (в категории LR-WPAN) и LoRaWAN (как LPWAN), а по ним список рекомендуемой литературы примерно такой:

### IEEE 802.15.4 и 6LoWPAN

Стандарт IEEE 802.15.4 (любая из версий) - я не ожидаю, что вы его прочитаете целиком (в самом компактном из вариантов это около 300 страниц довольно специфичного текста) - но ознакомиться хотя бы с разделами General Description и MAC functional description было бы неплохо.

**J. Ollson, 6LoWPAN Demystified** (https://www.ti.com/lit/wp/swry013/swry013.pdf) - краткое описание 6LoWPAN от Texas Instruments

**RFC 4944**, **RFC 6282** - стандарты передачи датаграмм IPv6 поверх физического уровня IEEE 802.15.4 и сжатия заголовков.

**RFC 6550** - протокол маршрутизации RPL, часто используемый в сетях 6LoWPAN.

### Bluetooth Low Energy

**Mohammad Afaneh, Intro to Bluetooth Low Energy** - сравнительно короткий пересказ стандарта BLE.

**RFC 7668**, **RFC 9159** - стандарты, описывающие передачу датаграмм IPv6 поверх Bluetooth Low Energy; советую обратить внимание на RFC 9159, разрешающий "древовидную" топологию сети. Со стороны Bluetooth SIG это же описано в **Internet Protocol Support Profile (IPSP)**: https://www.bluetooth.com/specifications/specs/internet-protocol-support-profile-1-0/

Практическое применение 6LoWPAN поверх BLE описано в сравнительно недавних работах:

https://diglib.tugraz.at/download.php?id=60a4ea6a34af4&location=browse - бакалаврская работа Alexander Wieland из TU Graz, описывающая взаимодействие устройства с ОС Android и датчиков с 6LoWPAN поверх BLE

https://ilab-pub.imp.fu-berlin.de/papers/psw-mgmio-21.pdf - о поддержке 6LoWPAN поверх BLE в Riot

https://www.hse.ru/edu/vkr/620909596 - дальнейшее развитие работы Alexander Wieland с добавлением поддержки RFC 9159.

### LoRa и LoRaWAN

**AN1200.22 LoRa Modulation Basics** - описание модуляции LoRa.

**SX1276-7-8-9 Datasheet** - справочное руководство модема LoRa.

**LoRaWAN 1.0.3 Specification** (https://lora-alliance.org/sites/default/files/2018-07/lorawan1.0.3.pdf) - описание MAC-уровня LoRaWAN. Желательно прочитать и понять к экзамену.

**RP2-1.0.1 LoRaWAN® Regional Parameters** (https://lora-alliance.org/sites/default/files/2020-06/rp_2-1.0.1.pdf) - региональные параметры LoRaWAN, приложение к предыдущему документу (к экзамену надо знать различия между EU868 и RU864).

### Разное

https://www.drive2.ru/b/957013/ - немного сбивчивое и эмоциональное, но довольно подробное описание "активной" атаки повтором на протокол с защитой сообщений с помощью счетчика.

17 главе **Introduction to Embedded Systems: A Cyber-Physical Systems Approach** посвящена описанию некоторых криптографических примитивов.

## Лекция 6

Подробное описание самых разных типов ЦАП и АЦП (в том числе и очень хорошее описание функционирования дельта-сигма преобразователей) можно найти в 13 главе **The Art of Electronics**.

Сокращенный пересказ нескольких руководств Analog Devices и описание работы дельта-сигма АЦП "на пальцах": https://habr.com/ru/articles/125029/

Некоторые сложности применения АЦП в микроконтроллерах, возникающие из-за наличия на входе мультиплексора и устройства выборки и хранения: https://leoniv.livejournal.com/194681.html

Прием с использованием ЦАП для отслеживания процессов в операционной системе подсмотрен в разделе 4.3 **Art of Designing Embedded Systems**.

## Лекция 7

Очень смешной видеоролик про Supra (разговор про энергопотребление начинается с 11:38, но не советую пропускать начало): https://www.youtube.com/watch?v=uAww9C0Ynpw.

Некоторые способы энергосбережения во встраиваемых системах описаны в 10 главе **Making Embedded Systems**.

Многие нюансы энергосбережения на STM32 упомянуты здесь: https://habr.com/ru/articles/430218/

Про проблему "спящих маршрутизаторов" в mesh-сетях можно прочитать в описании ContikiMAC: http://www.dunkels.com/adam/dunkels11contikimac.pdf и недавней статье разработчиков Riot о сетях 6LoWPAN поверх BLE: https://ilab-pub.imp.fu-berlin.de/papers/psw-mgmio-21.pdf

## Дополнительная литература

Основные, как это принято называть, prerequisites курса - знание языка Си и некоторое понимание работы компьютера на низком уровне. Желательно уметь работать в Unix-подобной среде, не лишним будет знание электроники на уровне "как подключить светодиод". Из литературы по этим вещам могу посоветовать следующее (читать все от корки до корки не обязательно - в любом случае это несколько примерно семестровых курсов, так что предполагаю, что значительных провалов ни в одной из областей нет):
 
## Язык программирования Си
 
**B. Kernighan, D. Ritchie, The C programming language** / **Б. Керниган, Д. Ритчи, Язык программирования Си** (разные издания) - классическое руководство по языку, в особых рекомендациях не нуждается, единственное предупреждение - в интернете иногда встречаются издания, описывающие ранний стандарт языка - это первое английское, 1978 года, и первое русское, 1985 года, издание. Часто упоминается, как K&R.
 
**Peter van der Linden, Expert C Programming: Deep C Secrets, Prentice Hall, 1994** - автор разрабатывал компилятор Си в Sun Microsystems, и в своей книге описывает некоторые неочевидные стороны языка; обычно рекомендуют, как "вторую книгу по Си" - предполагается, что читатель знает язык в общих чертах (прочитав K&R), но не сталкивался или не обращал внимания на некоторые неочевидные вещи.
 
**Ben Klemens, 21st Century C, O'Reilly, 2015** - обзор нововведений Си со времен описанного в K&R стандарта ANSI C 1989 года. Желательно прочитать, но некоторым советам оттуда следовать не стоит, они явно сомнительные. С другой стороны, знать о том, что Си с 1989 года во многом поменялся - полезно.
 
## Архитектура компьютеров, операционные системы и тому подобное
 
**Andrew S. Tanenbaum, Structured Computer Organization (6th Edition), Pearson, 2012** / **Эндрю Таненбаум, Архитектура компьютера, Питер, 2013** - классический учебник Таненбаума, первое издание вышло в 1976 году, в 1979 переведено на русский и издано под названием "Многоуровневая архитектура ЭВМ" издательством "Мир". С тех пор профессор Таненбаум регулярно актуализирует материал - например, если в первом издании "показательными" примерами были IBM/360, PDP-11 и CDC-6000, то в каждом новом издании этот список меняется, наиболее полезным для нашего курса будет 6 издание, где в качестве таковых рассматриваются Intel Core i7, OMAP 4330 и AtMega168. Книга довольно толстая (и с каждым новым изданием все увеличивается и увеличивается), но если говорить о 6 издании - то интерес в контексте нашего курса представляют главы 1, частично 2 и 4, 5 и частично 7.
 
**Andrew S. Tanenbaum, Modern Operating Systems** / **Эндрю Таненбаум, Современные операционные системы** (разные издания) - опять же, довольно классический учебник; возможно, некоторым покажется более интересной "Разработка и реализация операционных систем" того же автора - но тут опять же, интерес представляет не книга целиком, а некоторые главы, посвященные межпроцессному взаимодействию и смежным вопросам (совместное использование ресурсов, взаимоблокировки и тому подобное).
 
## Микроконтроллеры и встраиваемые системы

Это не столько prerequisites, сколько то, что надо использовать, если что-то кажется непонятным (помимо даташитов для используемых МК).
 
**Jonathan W. Valvano, Embedded systems** (разные издания) - трехтомник с курсом по программированию встраиваемых систем на микроконтроллерах с архитектурой ARM "от азов"; используется серия MSP432 фирмы Texas Instruments (а вы ожидали что-то другого от курса в Университете Техаса?..). Книги в некоторой степени повторяют друг друга, так что реальный объем - где-то полтора тома. Особой специфики у MSP432 в сравнении с другими микроконтроллерами нет, так что можно использовать в качестве учебника и при работе с другими вариантами ARM Cortex-M.
 
**Tammy Noergaard, Embedded Systems Architecture: A Comprehensive Guide for Engineers and Programmers, Elsevier, 2005** - несколько более полная и "фундаментальная" книга по проектированию встраиваемых систем, начинающаяся от самых "азов". Рассматриваются не только микроконтроллеры, а еще и встраиваемые системы с процессорами "общего назначения", поэтому в этом курсе где-то треть книги можно безболезненно пропустить. Основное достоинство - четкость определений, характерная для учебника.
 
**Joseph Yiu, The Definitive Guide to ARM Cortex-M3 and Cortex-M4 Processors, Elsevier, 2014** - "почти официальное" (написанное сотрудником ARM) руководство по архитектуре ARM Cortex-M.
 
**Carmine Noviello, Mastering STM32** - пример "традиционного" руководства по STM32, начинающегося с длинного и сложного описания архитектуры процессора, с активным использованием "фирменного" Hardware Abstraction Layer и CubeMX; только в самом конце наконец-то появляется FreeRTOS, и то на уровне "добавьте такие-то файлики в проект или поставьте галочку в CubeMX". Можно использовать, как пересказ «даташита» понятным языком.

## Разное

Эти книги и статьи в основном могут понадобиться тем, кто не очень уверенно чувствует себя при работе с Unix-подобным окружением.

**А. В. Столяров, Программирование: введение в профессию**(http://www.stolyarov.info/books/programming_intro) - "краудсорсинговый" многотомник по классическим "программистским" курсам, читающимся на факультете ВМК МГУ. Автор иногда впадает в некий экстремизм, например, объявляя единственно правильным способом работы с компьютером использование Unix-образной командной строки, а программистов под Windows считает низшей кастой. С другой стороны, это одна из немногих известных мне книг, где "под одной обложкой" были бы собраны работа в командной строке Unix, программирование на Си, работа с системами контроля версий и так далее.
 
https://blog.regolit.com/2014/02/17/a-bit-of-git - краткое введение в систему контроля версий Git.
 
**Scott Chacon, Pro Git** (https://git-scm.com/book/en/v2): как подсказывает название, это книга *про Git* - если предыдущей статьи окажется недостаточно.
 
**Vincent Driessen: A successful Git branching model** (https://nvie.com/posts/a-successful-git-branching-model) - описание способа использования "веток" в Git и подобных системах контроля версий.